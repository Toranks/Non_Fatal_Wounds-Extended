#textdomain wesnoth-Non_Fatal_Wounds

# filter plagueable plagued units
[event]
    name=last_breath
    id=nfwme_death_plague
    first_time_only=no
    [filter_condition]
        {VARIABLE_CONDITIONAL nfw_all_plagued not_equals yes}
        [and]
            [not]
                {NFW_wounds_DISABLED}
            [/not]
        [/and]
    [/filter_condition]
    [filter]
        {EVENT_UNIT}
        [not]
            status=unplagueable
        [/not]
        [not]
            [filter_location]
                terrain=*^V*
            [/filter_location]
        [/not]
    [/filter]
    [filter_second_attack]
        special_type=plague
    [/filter_second_attack]
    {NFW_plagued_WOUND}
    {VARIABLE nfw_already_dead yes}
[/event]

# filter forced plagued for some scenarios
[event]
    name=last_breath
    id=nfwme_death_plague_forced
    first_time_only=no
    [filter_condition]
        {VARIABLE_CONDITIONAL nfw_all_plagued equals yes}
        [and]
            [not]
                {NFW_wounds_DISABLED}
            [/not]
        [/and]
    [/filter_condition]
    [filter]
        {EVENT_UNIT}
        side=1
        [not]
            id=Commander Aethyr
        [/not]
    [/filter]
    {NFW_plagued_WOUND}
    {VARIABLE nfw_already_dead yes}
[/event]

# random wound table
[event]
    name=last_breath
    id=nfwme_wound_table
    first_time_only=no

    {VARIABLE nfwme_rand_scary_weapon $second_weapon.name}
    {VARIABLE nfwme_rand_weapon_type $second_weapon.type}

    [if]
        {VARIABLE_CONDITIONAL nfw_already_dead equals yes}
        [or]
            {NFW_wounds_DISABLED}
        [/or]
        [or]
            {NFW_wounds_DISABLED_with_plague}
        [/or]
        [then]
            {CLEAR_VARIABLE nfw_already_dead}
        [/then]
        [else]
            [store_unit_type]
                type=$unit.type
                variable=nfwe_unit_type
            [/store_unit_type]
            [fire_event]
                name=nfwe_rand_wound
                [primary_unit]
                    {EVENT_UNIT}
                [/primary_unit]
                [secondary_unit]
                    {EVENT_SECOND_UNIT}
                [/secondary_unit]
            [/fire_event]
        [/else]
    [/if]
[/event]

[event]
    name=nfwe_rand_wound
    id=nfwe_rand_wound_id
    first_time_only=no
    {VARIABLE rand_wound_repeat yes}
	[while]
		{VARIABLE_CONDITIONAL rand_wound_repeat equals yes}
		[do]
			{VARIABLE_OP rand_wound rand(1..220)}
			[switch]
				variable=rand_wound
				[case]
					value=1,68,108
					[if]
						[have_location]
							{EVENT_UNIT}
							[filter]
								[has_attack]
									special_id=magical
								[/has_attack]
							[/filter]
						[/have_location]
						[then]
							{NFW_concussion_WOUND}
							{VARIABLE rand_wound_repeat no}
						[/then]
					[/if]
				[/case]
				[case]
					value=2,3
					[if]
						[have_location]
							{EVENT_UNIT}
							[filter]
								race=mechanical
							[/filter]
						[/have_location]
						[elseif]
							[have_location]
								{EVENT_UNIT}
								terrain=A*,D*
							[/have_location]
							[then]
								{NFW_fear_of_desert_WOUND}
								{VARIABLE rand_wound_repeat no}
							[/then]
						[/elseif]
						[elseif]
							[have_location]
								{EVENT_UNIT}
								terrain=F*,T*,*^F*,*^T*
							[/have_location]
							[then]
								{NFW_fear_of_plant_WOUND}
								{VARIABLE rand_wound_repeat no}
							[/then]
						[/elseif]
						[elseif]
							[have_location]
								{EVENT_UNIT}
								terrain=U*
							[/have_location]
							[then]
								{NFW_fear_of_cave_WOUND}
								{VARIABLE rand_wound_repeat no}
							[/then]
						[/elseif]
						[elseif]
							[have_location]
								{EVENT_UNIT}
								terrain=M*,H*
							[/have_location]
							[then]
								{NFW_fear_of_hight_WOUND}
								{VARIABLE rand_wound_repeat no}
							[/then]
						[/elseif]
						[elseif]
							[have_location]
								{EVENT_UNIT}
								terrain=W*,S*
							[/have_location]
							[then]
								{NFW_fear_of_water_WOUND}
								{VARIABLE rand_wound_repeat no}
							[/then]
						[/elseif]
						[elseif]
							[have_location]
								{EVENT_UNIT}
								terrain=G*,R*
								[not]
									terrain=*^V*,*^P*,*^E*,*^F*,*^T*,*^B*
								[/not]
								[not]
									time_of_day_id=indoors,underground,deep_underground
								[/not]
							[/have_location]
							[then]
								{NFW_fear_of_open_WOUND}
								{VARIABLE rand_wound_repeat no}
							[/then]
						[/elseif]
					[/if]
				[/case]
				[case]
					value=69,119
					[if]
						[have_location]
							{EVENT_UNIT}
							[filter]
								race=mechanical
							[/filter]
						[/have_location]
						[elseif]
							[have_location]
								{EVENT_UNIT}
								terrain=W*,S*
							[/have_location]
							[then]
								[if]
									[have_location]
										{EVENT_UNIT}
										[filter]
											race=merman,naga
										[/filter]
									[/have_location]
									[else]
										{NFW_fear_of_water_WOUND}
										{VARIABLE rand_wound_repeat no}
									[/else]
								[/if]
							[/then]
						[/elseif]
						[elseif]
							[have_location]
								{EVENT_UNIT}
								terrain=A*,D*
							[/have_location]
							[then]
								{NFW_fear_of_desert_WOUND}
								{VARIABLE rand_wound_repeat no}
							[/then]
						[/elseif]
						[elseif]
							[have_location]
								{EVENT_UNIT}
								terrain=U*
							[/have_location]
							[then]
								{NFW_fear_of_cave_WOUND}
								{VARIABLE rand_wound_repeat no}
							[/then]
						[/elseif]
						[elseif]
							[have_location]
								{EVENT_UNIT}
								terrain=F*,T*,*^F*,*^T*
							[/have_location]
							[then]
								{NFW_fear_of_plant_WOUND}
								{VARIABLE rand_wound_repeat no}
							[/then]
						[/elseif]
						[elseif]
							[have_location]
								{EVENT_UNIT}
								terrain=M*,H*
							[/have_location]
							[then]
								{NFW_fear_of_hight_WOUND}
								{VARIABLE rand_wound_repeat no}
							[/then]
						[/elseif]
					[/if]
				[/case]
				[case]
					value=4
					[if]
						[have_location]
							{EVENT_UNIT}
							[filter]
								race=mechanical
							[/filter]
						[/have_location]
						[or]
							[have_location]
								{EVENT_UNIT}
								[filter]
									ability=nfw_scared_of_dark
								[/filter]
							[/have_location]
						[/or]
						[or]
							[have_location]
								{EVENT_UNIT}
								[filter]
									ability=nfw_scared_of_light
								[/filter]
							[/have_location]
						[/or]
						[else]
							[if]
								[have_location]
									{EVENT_UNIT}
									time_of_day=chaotic
								[/have_location]
								[then]
									{NFW_fear_of_dark_WOUND}
									{VARIABLE rand_wound_repeat no}
								[/then]
								[elseif]
									[have_location]
										{EVENT_UNIT}
										time_of_day=lawful
									[/have_location]
									[then]
										{NFW_fear_of_light_WOUND}
										{VARIABLE rand_wound_repeat no}
									[/then]
								[/elseif]
							[/if]
						[/else]
					[/if]
				[/case]
				[case]
					value=5,6,7,106,109,151
					[if]
						{VARIABLE_CONDITIONAL nfwme_rand_weapon_type equals ice}
						[or]
							[have_location]
								{EVENT_UNIT}
								terrain=A*,Ms*,Ha*,Cea^*,Coa^*,Cha^*,Cva^*,Cfa^*,Kea^*,Koa^*,Kha^*,Kva^*,Kfa^*,Rra^*,*^Esa,*^Fpa,*^Feta,*^Fda,*^Fma,*^Voa,*^Vea,*^Vha,*^Vhca,*^Vhha,*^Vca,*^Vla,*^Vaa
							[/have_location]
						[/or]
						[then]
							{NFW_frostbite_WOUND}
							{VARIABLE rand_wound_repeat no}
						[/then]
					[/if]
				[/case]
				[case]
					value=8,70
					[if]
						[have_location]
							{EVENT_UNIT}
							[filter]
								[has_attack]
									special_id=magical
								[/has_attack]
							[/filter]
						[/have_location]
						[and]
							[not]
								[have_location]
									{EVENT_UNIT}
									[filter]
										ability=wild_magic_display
									[/filter]
								[/have_location]
							[/not]
						[/and]
						[then]
							{NFW_wild_magic_WOUND}
							{VARIABLE rand_wound_repeat no}
						[/then]
					[/if]
				[/case]
				[case]
					value=9,10,11,107,110,152,153,154,155
					[if]
						{VARIABLE_CONDITIONAL nfwme_rand_weapon_type equals fire}
						[or]
							[have_location]
								{EVENT_UNIT}
								terrain=*^Ecf,*^Eb,Ql*,Mv*,Yl*
							[/have_location]
						[/or]
						[then]
							{NFW_burned_WOUND}
							{VARIABLE rand_wound_repeat no}
						[/then]
					[/if]
				[/case]
				[case]
					value=12
					[if]
						[have_location]
							{EVENT_UNIT}
							[filter]
								race=horse,monster,wolf,bats,falcon,gryphon,bird
								[or]
									type=SotA Soulless_Bat,SotA Flying Corpse_Bat
								[/or]
								[or]
									variation=bat,falcon,gryphon,bird,horse,rat,spider,serpent,boar,wolf
								[/or]
							[/filter]
						[/have_location]
						[or]
							{VARIABLE_CONDITIONAL nfwe_unit_type.movement_type equals undeadspirit}
						[/or]
						[else]
							{NFW_broken_arm_WOUND}
							{VARIABLE rand_wound_repeat no}
						[/else]
					[/if]
				[/case]
				[case]
					value=111,112,113,114,115
					[if]
						[have_location]
							{EVENT_UNIT}
							[filter]
								race=bats,falcon,gryphon,drake,bird
								[or]
									type=SotA Soulless_Bat,SotA Flying Corpse_Bat
								[/or]
								[or]
									variation=bat,drake,falcon,gryphon,bird
								[/or]
							[/filter]
						[/have_location]
						[and]
							[have_location]
								{EVENT_UNIT}
								[filter]
									formula="max_moves > 1"
								[/filter]
							[/have_location]
						[/and]
						[then]
							{NFW_broken_wing_WOUND}
							{VARIABLE rand_wound_repeat no}
						[/then]
					[/if]
				[/case]
				[case]
					value=13
					[if]
						[have_location]
							{EVENT_UNIT}
							[filter]
								race=bats,falcon,gryphon,naga,merman,bird
								[or]
									type=SotA Soulless_Bat,SotA Flying Corpse_Bat
								[/or]
								[or]
									variation=bat,drake,falcon,gryphon,swimmer,bird
								[/or]
							[/filter]
						[/have_location]
						[or]
							[have_location]
								{EVENT_UNIT}
								[filter]
									formula="max_moves <= 1"
								[/filter]
							[/have_location]
						[/or]
						[or]
							{VARIABLE_CONDITIONAL nfwe_unit_type.movement_type equals undeadspirit}
						[/or]
						[else]
							{NFW_broken_leg_WOUND}
							{VARIABLE rand_wound_repeat no}
						[/else]
					[/if]
				[/case]
				[case]
					value=116,117,118
					[if]
						{VARIABLE_CONDITIONAL nfwme_rand_weapon_type equals impact}
						[and]
							[not]
								[have_location]
									{EVENT_UNIT}
									[filter]
										race=mechanical
									[/filter]
								[/have_location]
								[or]
									{VARIABLE_CONDITIONAL nfwe_unit_type.movement_type equals undeadspirit}
								[/or]
							[/not]
						[/and]
						[then]
							{NFW_broken_rib_WOUND}
							{VARIABLE rand_wound_repeat no}
						[/then]
					[/if]
				[/case]
				[case]
					value=14
					[if]
						[have_location]
							{EVENT_UNIT}
							[filter]
								race=mechanical
							[/filter]
						[/have_location]
						[or]
							{VARIABLE_CONDITIONAL nfwe_unit_type.movement_type equals undeadspirit}
						[/or]
						[else]
							{NFW_broken_rib_WOUND}
							{VARIABLE rand_wound_repeat no}
						[/else]
					[/if]
				[/case]
				[case]
					value=15,16,17,120
					[if]
						{VARIABLE_CONDITIONAL nfwme_rand_weapon_type equals blade}
						[then]
							{NFW_gash_WOUND}
							{VARIABLE rand_wound_repeat no}
						[/then]
					[/if]
				[/case]
				[case]
					value=18
					[if]
						[have_location]
							{EVENT_UNIT}
							[filter]
								[has_attack]
									special_type=berserk
								[/has_attack]
							[/filter]
						[/have_location]
						[or]
							[not]
								[have_location]
									{EVENT_UNIT}
									[filter]
										[has_attack]
											range=melee
										[/has_attack]
									[/filter]
								[/have_location]
							[/not]
						[/or]
						[else]
							{NFW_insane_WOUND}
							{VARIABLE rand_wound_repeat no}
						[/else]
					[/if]
				[/case]
				[case]
					value=19
					[if]
						[have_location]
							{EVENT_UNIT}
							[filter]
								status=unpoisonable
							[/filter]
						[/have_location]
						[or]
							[have_location]
								{EVENT_UNIT}
								[filter]
									ability=infection_display
								[/filter]
							[/have_location]
						[/or]
						[else]
							{NFW_infection_WOUND}
							{VARIABLE rand_wound_repeat no}
						[/else]
					[/if]
				[/case]
				[case]
					value=20
					[if]
						[have_location]
							{EVENT_UNIT}
							[filter]
								ability=amnesia_dummy
							[/filter]
						[/have_location]
						[else]
							{NFW_amnesia_WOUND}
							{VARIABLE rand_wound_repeat no}
						[/else]
					[/if]
				[/case]
				[case]
					value=21
		#ifdef CAMPAIGN_NORTHERN_REBIRTH
					[if]
						[have_location]
							{EVENT_UNIT}
							[filter]
								id=Sister Thera,Father Morvin
							[/filter]
						[/have_location]
						[else]
		#endif
							{NFW_captured_WOUND}
							{VARIABLE rand_wound_repeat no}
		#ifdef CAMPAIGN_NORTHERN_REBIRTH
						[/else]
					[/if]
		#endif
				[/case]
				[case]
					value=71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100
					[if]
						{NFW_FILTER_HEROES}
						[then]
							{NFW_captured_WOUND}
							{VARIABLE rand_wound_repeat no}
						[/then]
					[/if]
				[/case]
				[case]
					value=22
					[if]
						[have_location]
							{EVENT_UNIT}
							[filter]
								race=mechanical
							[/filter]
						[/have_location]
						[else]
							{NFW_Coward_WOUND}
							{VARIABLE rand_wound_repeat no}
						[/else]
					[/if]
				[/case]
				[case]
					value=23,121,122
					[if]
						[have_location]
							{EVENT_UNIT}
							[filter]
								race=mechanical
							[/filter]
						[/have_location]
						[or]
							[have_location]
								{EVENT_UNIT}
								[filter]
									ability=nfw_scared_of_weapon
								[/filter]
							[/have_location]
						[/or]
						[else]
							{NFW_fear_of_weapon_WOUND}
							{VARIABLE rand_wound_repeat no}
						[/else]
					[/if]
				[/case]
				[case]
					value=24,123
					[if]
						[have_location]
							{EVENT_UNIT}
							[filter]
								race=mechanical
							[/filter]
						[/have_location]
						[else]
							{NFW_maimed_WOUND}
							{VARIABLE rand_wound_repeat no}
						[/else]
					[/if]
				[/case]
				[case]
					value=25
					[if]
						[have_location]
							{EVENT_UNIT}
							[filter]
								ability=sick_display
							[/filter]
						[/have_location]
						[else]
							{NFW_sick_WOUND}
							{VARIABLE rand_wound_repeat no}
						[/else]
					[/if]
				[/case]
				[case]
					value=47,101,102,103,104,105,124,125,126,127,128,132,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200
					[if]
						[have_location]
							{EVENT_UNIT}
							[filter]
								status=slowed
							[/filter]
						[/have_location]
						[and]
							[not]
								[have_location]
									{EVENT_UNIT}
									[filter]
										ability=sick_display
									[/filter]
								[/have_location]
							[/not]
						[/and]
						[then]
							{NFW_sick_WOUND}
							{VARIABLE rand_wound_repeat no}
						[/then]
						[elseif]
							[have_location]
								{EVENT_UNIT}
								[filter]
									status=poisoned
								[/filter]
							[/have_location]
							[and]
								[not]
									[have_location]
										{EVENT_UNIT}
										[filter]
											ability=infection_display
										[/filter]
									[/have_location]
								[/not]
							[/and]
							[then]
								{NFW_infection_WOUND}
								{VARIABLE rand_wound_repeat no}
							[/then]
						[/elseif]
					[/if]
				[/case]
				[case]
					value=26
					[if]
						[have_location]
							{EVENT_UNIT}
							[filter]
								race=mechanical
							[/filter]
						[/have_location]
						[else]
							{NFW_necrosis_WOUND}
							{VARIABLE rand_wound_repeat no}
						[/else]
					[/if]
				[/case]
				[case]
					value=27,67,129,130
					[if]
						[have_location]
							{EVENT_UNIT}
							[filter]
								formula="experience < (max_experience / 1.5)"
							[/filter]
						[/have_location]
						[else]
							{NFW_short_term_memory_loss_WOUND}
							{VARIABLE rand_wound_repeat no}
						[/else]
					[/if]
				[/case]
				[case]
					value=28,29,30,31,32,33
					[if]
						{NFW_undead_ENABLED}
						[and]
							{VARIABLE_CONDITIONAL nfwe_unit_type.movement_type not_equals undeadspirit}
						[/and]
						[and]
							[not]
								[have_location]
									{EVENT_UNIT}
									[filter]
										trait=ghost_trait,undead
									[/filter]
								[/have_location]
							[/not]
						[/and]
		#ifdef CAMPAIGN_NORTHERN_REBIRTH
						[and]
							[not]
								[have_location]
									{EVENT_UNIT}
									[filter]
										id=Sister Thera,Father Morvin
									[/filter]
								[/have_location]
							[/not]
						[/and]
		#endif
						[then]
							{NFW_undead_ghost_WOUND {TRAIT_UNDEAD}}
							{VARIABLE rand_wound_repeat no}
						[/then]
						[elseif]
							{NFW_undead_ENABLED}
							[and]
								{VARIABLE_CONDITIONAL nfwe_unit_type.movement_type not_equals undeadspirit}
							[/and]
							[and]
								[not]
									[have_location]
										{EVENT_UNIT}
										[filter]
											trait=ghost_trait
										[/filter]
									[/have_location]
								[/not]
							[/and]
		#ifdef CAMPAIGN_NORTHERN_REBIRTH
							[and]
								[not]
									[have_location]
										{EVENT_UNIT}
										[filter]
											id=Sister Thera,Father Morvin
										[/filter]
									[/have_location]
								[/not]
							[/and]
		#endif
							[and]
								[have_location]
									{EVENT_UNIT}
									[filter]
										trait=undead
									[/filter]
								[/have_location]
							[/and]
							[then]
								{NFW_undead_ghost_WOUND {NFW_TRAIT_UNDEAD}}
								{VARIABLE rand_wound_repeat no}
							[/then]
						[/elseif]
						[elseif]
							{NFW_dead_ENABLED}
		#ifdef CAMPAIGN_NORTHERN_REBIRTH
							[and]
								[not]
									[have_location]
										{EVENT_UNIT}
										[filter]
											id=Sister Thera,Father Morvin
										[/filter]
									[/have_location]
								[/not]
							[/and]
		#endif
							[then]
								{NFW_dead_WOUND}
								{VARIABLE rand_wound_repeat no}
							[/then]
						[/elseif]
					[/if]
				[/case]
				[case]
					value=38,39,40,41,42,43,44,45,46
					[if]
						{NFW_undead_ENABLED}
						[and]
							[not]
								[have_location]
									{EVENT_UNIT}
									[filter]
										race=undead
									[/filter]
								[/have_location]
							[/not]
						[/and]
		#ifdef CAMPAIGN_NORTHERN_REBIRTH
						[and]
							[not]
								[have_location]
									{EVENT_UNIT}
									[filter]
										id=Sister Thera,Father Morvin
									[/filter]
								[/have_location]
							[/not]
						[/and]
		#endif
						[then]
							{NFW_undead_corpse_WOUND}
							{VARIABLE rand_wound_repeat no}
						[/then]
						[elseif]
							{NFW_dead_ENABLED}
		#ifdef CAMPAIGN_NORTHERN_REBIRTH
							[and]
								[not]
									[have_location]
										{EVENT_UNIT}
										[filter]
											id=Sister Thera,Father Morvin
										[/filter]
									[/have_location]
								[/not]
							[/and]
		#endif
							[then]
								{NFW_dead_WOUND}
								{VARIABLE rand_wound_repeat no}
							[/then]
						[/elseif]
					[/if]
				[/case]
				[case]
					value=34,35,36,37,48,49,50,51,52,53,54,55,56,57,133,134,135,136,137,138,139,140
					[if]
						{NFW_dead_ENABLED}
						[or]
							{NFW_undead_ENABLED}
						[/or]
		#ifdef CAMPAIGN_NORTHERN_REBIRTH
						[and]
							[not]
								[have_location]
									{EVENT_UNIT}
									[filter]
										id=Sister Thera,Father Morvin
									[/filter]
								[/have_location]
							[/not]
						[/and]
		#endif
						[then]
							{NFW_dead_WOUND}
							{VARIABLE rand_wound_repeat no}
						[/then]
					[/if]
				[/case]
				[case]
					value=58,59,60,61,62
					[if]
						{NFW_funny_ENABLED}
						[then]
							{NFW_paper_cut_WOUND}
							{VARIABLE rand_wound_repeat no}
						[/then]
					[/if]
				[/case]
				[case]
					value=63,64,65,66
					[if]
						{NFW_funny_ENABLED}
						[then]
							{NFW_stepped_on_lego_WOUND}
							{VARIABLE rand_wound_repeat no}
						[/then]
					[/if]
				[/case]
				[case]
					value=141,142,143,131
					[if]
						[have_location]
							{EVENT_UNIT}
							[filter]
								[filter_side]
									formula="fog"
								[/filter_side]
							[/filter]
						[/have_location]
						[then]
							{NFW_fear_of_fog_WOUND}
							{VARIABLE rand_wound_repeat no}
						[/then]
					[/if]
				[/case]
				[case]
					value=144,145,146,147,148,149,150,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220
					[if]
						[have_location]
							{EVENT_UNIT}
							[filter]
								race=mechanical
							[/filter]
						[/have_location]
						[then]
							{NFW_damaged_WOUND}
							{VARIABLE rand_wound_repeat no}
						[/then]
					[/if]
				[/case]
				[case]
					value=156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175
					[if]
						{NFW_elemental_DISABLED}
						[or]
							[have_location]
								{EVENT_UNIT}
								[filter]
									race=mechanical,undead
								[/filter]
							[/have_location]
						[/or]
		#ifdef CAMPAIGN_NORTHERN_REBIRTH
						[or]
							[have_location]
								{EVENT_UNIT}
								[filter]
									id=Sister Thera,Father Morvin
								[/filter]
							[/have_location]
						[/or]
		#endif
						[or]
							{VARIABLE_CONDITIONAL nfwe_unit_type.movement_type equals undeadspirit}
						[/or]
						[or]
							[have_location]
								{EVENT_UNIT}
								[filter]
									trait=ghost_trait,undead,elemental
								[/filter]
							[/have_location]
						[/or]
						[elseif]
							[have_location]
								{EVENT_UNIT}
								terrain=Qxua
							[/have_location]
							[then]
								{NFW_elemental_arcane_WOUND}
								{VARIABLE rand_wound_repeat no}
							[/then]
						[/elseif]
						[elseif]
							[have_location]
								{EVENT_UNIT}
								[filter]
									status=poisoned
								[/filter]
							[/have_location]
							[then]
								{NFW_elemental_poison_WOUND}
								{VARIABLE rand_wound_repeat no}
							[/then]
						[/elseif]
						[elseif]
							[have_location]
								{EVENT_UNIT}
								terrain=*^Wm,^Vwm
							[/have_location]
							[then]
								{NFW_elemental_air_WOUND}
								{VARIABLE rand_wound_repeat no}
							[/then]
						[/elseif]
						[elseif]
							{VARIABLE_CONDITIONAL nfwme_rand_weapon_type equals fire}
							[or]
								[have_location]
									{EVENT_UNIT}
									terrain=*^Ecf,*^Eb,Ql*,Mv*,Yl*
								[/have_location]
							[/or]
							[then]
								{NFW_elemental_fire_WOUND}
								{VARIABLE rand_wound_repeat no}
							[/then]
						[/elseif]
						[elseif]
							{VARIABLE_CONDITIONAL nfwme_rand_weapon_type equals arcane}
							[then]
								{NFW_elemental_arcane_WOUND}
								{VARIABLE rand_wound_repeat no}
							[/then]
						[/elseif]
						[elseif]
							{VARIABLE_CONDITIONAL nfwme_rand_weapon_type equals cold}
							[or]
								[have_location]
									{EVENT_UNIT}
									terrain=A*,W*,S*,Ms*,Ha*,Cea^*,Coa^*,Cha^*,Cva^*,Cfa^*,Kea^*,Koa^*,Kha^*,Kva^*,Kfa^*,Rra^*,*^Esa,*^Fpa,*^Feta,*^Fda,*^Fma,*^Voa,*^Vea,*^Vha,*^Vhca,*^Vhha,*^Vca,*^Vla,*^Vaa
								[/have_location]
							[/or]
							[then]
								{NFW_elemental_water_WOUND}
								{VARIABLE rand_wound_repeat no}
							[/then]
						[/elseif]
						[elseif]
							[have_location]
								{EVENT_UNIT}
								[filter]
									[has_attack]
										special_type=poison
									[/has_attack]
								[/filter]
							[/have_location]
							[then]
								{NFW_elemental_poison_WOUND}
								{VARIABLE rand_wound_repeat no}
							[/then]
						[/elseif]
						[elseif]
							[have_location]
								{EVENT_UNIT}
								terrain=U*
							[/have_location]
							[then]
								{NFW_elemental_earth_WOUND}
								{VARIABLE rand_wound_repeat no}
							[/then]
						[/elseif]
						[elseif]
							[have_location]
								{EVENT_UNIT}
								[filter]
									race=naga,merman
								[/filter]
							[/have_location]
							[or]
								[have_location]
									{EVENT_UNIT}
									[filter]
										[has_attack]
											type=cold
										[/has_attack]
									[/filter]
								[/have_location]
							[/or]
							[then]
								{NFW_elemental_water_WOUND}
								{VARIABLE rand_wound_repeat no}
							[/then]
						[/elseif]
						[elseif]
							[have_location]
								{EVENT_UNIT}
								[filter]
									[has_attack]
										type=arcane
									[/has_attack]
								[/filter]
							[/have_location]
							[then]
								{NFW_elemental_arcane_WOUND}
								{VARIABLE rand_wound_repeat no}
							[/then]
						[/elseif]
						[elseif]
							[have_location]
								{EVENT_UNIT}
								[filter]
									[has_attack]
										type=fire
									[/has_attack]
								[/filter]
							[/have_location]
							[then]
								{NFW_elemental_fire_WOUND}
								{VARIABLE rand_wound_repeat no}
							[/then]
						[/elseif]
						[elseif]
							[have_location]
								{EVENT_UNIT}
								[filter]
									race=bats,falcon,gryphon,bird
								[/filter]
							[/have_location]
							[then]
								{NFW_elemental_air_WOUND}
								{VARIABLE rand_wound_repeat no}
							[/then]
						[/elseif]
						[elseif]
							{VARIABLE_CONDITIONAL nfwme_rand_weapon_type equals impact}
							[or]
								[have_location]
									{EVENT_UNIT}
									[filter]
										[has_attack]
											type=impact
										[/has_attack]
									[/filter]
								[/have_location]
							[/or]
							[then]
								{NFW_elemental_earth_WOUND}
								{VARIABLE rand_wound_repeat no}
							[/then]
						[/elseif]
						[elseif]
							{VARIABLE_CONDITIONAL nfwme_rand_weapon_type equals blade}
							[or]
								[have_location]
									{EVENT_UNIT}
									[filter]
										[has_attack]
											type=blade
										[/has_attack]
									[/filter]
								[/have_location]
							[/or]
							[then]
								{NFW_elemental_air_WOUND}
								{VARIABLE rand_wound_repeat no}
							[/then]
						[/elseif]
						[elseif]
							{VARIABLE_CONDITIONAL nfwme_rand_weapon_type equals pierce}
							[or]
								[have_location]
									{EVENT_UNIT}
									[filter]
										[has_attack]
											type=pierce
										[/has_attack]
									[/filter]
								[/have_location]
							[/or]
							[then]
								{NFW_elemental_poison_WOUND}
								{VARIABLE rand_wound_repeat no}
							[/then]
						[/elseif]
					[/if]
				[/case]
			[/switch]
		[/do]
	[/while]
    {CLEAR_VARIABLE rand_wound}
[/event]
